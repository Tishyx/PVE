<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rogue PvE Damage Dummy Simulator</title>
    <link rel="stylesheet" href="style.css">
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.21.0"
  }
}
</script>
</head>
<body>
    <div class="main-container">
        <header class="header">
            <h1>Rogue PvE Damage Dummy Simulator</h1>
            <p>Optimize your rotation, track buffs, and perfect your DPS uptime.</p>
        </header>

        <div class="game-layout">
            <!-- Left Panel: Configuration -->
            <aside class="panel configuration-panel">
                <section class="panel-section">
                    <h2>Character Stats</h2>
                    <form id="statsForm" class="form-grid">
                        <label>
                            <span>Attack Power</span>
                            <input type="number" id="attackPower" min="0" value="1200">
                        </label>
                        <label>
                            <span>Weapon Damage Min</span>
                            <input type="number" id="weaponMin" min="0" value="150">
                        </label>
                        <label>
                            <span>Weapon Damage Max</span>
                            <input type="number" id="weaponMax" min="0" value="220">
                        </label>
                        <label>
                            <span>Crit Chance (%)</span>
                            <input type="number" id="critChance" min="0" max="100" value="25">
                        </label>
                        <label>
                            <span>Hit Chance (%)</span>
                            <input type="number" id="hitChance" min="0" max="100" value="95">
                        </label>
                    </form>
                </section>

                <section class="panel-section">
                    <h2>Energy Regeneration</h2>
                    <div class="form-grid">
                        <label>
                            <span>Max Energy</span>
                            <input type="number" id="maxEnergy" min="100" max="250" value="100">
                        </label>
                        <label>
                            <span>Tick Interval (ms)</span>
                            <input type="number" id="tickInterval" min="100" value="2000">
                        </label>
                        <label>
                            <span>Energy per Tick</span>
                            <input type="number" id="energyPerTick" min="0" value="20">
                        </label>
                        <label>
                            <span>Talent Bonus (%)</span>
                            <input type="number" id="talentBonus" min="0" value="30">
                        </label>
                    </div>
                </section>

                <section class="panel-section">
                    <h2>Combat Procs</h2>
                    <div id="procConfig" class="proc-config"></div>
                </section>

                <section class="panel-section">
                    <h2>Talent Lab</h2>
                    <div class="talent-grid">
                        <label class="talent-option">
                            <input type="checkbox" id="talentPrecision">
                            <span>
                                <strong>Precision Strikes</strong>
                                <small>+3% hit chance. Finishers gain +5% crit chance and deal 8% more damage.</small>
                            </span>
                        </label>
                        <label class="talent-option">
                            <input type="checkbox" id="talentRelentless">
                            <span>
                                <strong>Relentless Strikes</strong>
                                <small>Spending combo points refunds energy based on points consumed.</small>
                            </span>
                        </label>
                        <label class="talent-option">
                            <input type="checkbox" id="talentShadowTechniques">
                            <span>
                                <strong>Shadow Techniques</strong>
                                <small>Auto attacks have a 30% chance to grant 1 combo point.</small>
                            </span>
                        </label>
                    </div>
                </section>

                <section class="panel-section">
                    <h2>Combat Control</h2>
                    <div class="control-buttons">
                        <button type="button" id="startCombat" class="primary">Start Combat</button>
                        <button type="button" id="stopCombat">Stop Combat</button>
                        <button type="button" id="resetCombat">Reset</button>
                    </div>
                    <div class="combat-timer">
                        <span>Combat Time:</span>
                        <strong id="combatTimer">0:00</strong>
                    </div>
                    <div class="session-compare">
                        <h3>Session Comparison</h3>
                        <div class="session-card">
                            <div>
                                <span class="label">Previous DPS</span>
                                <span id="previousDps">-</span>
                            </div>
                            <div>
                                <span class="label">Current DPS</span>
                                <span id="currentDpsCompare">-</span>
                            </div>
                            <div>
                                <span class="label">Delta</span>
                                <span id="dpsDelta">-</span>
                            </div>
                        </div>
                    </div>
                </section>
            </aside>

            <!-- Center Panel: Combat -->
            <main class="panel combat-panel">
                <section class="combat-stage">
                    <div class="dummy-container">
                        <div class="dummy-health">
                            <div class="dummy-health-bar" id="dummyHealthBar"></div>
                            <span class="dummy-health-text" id="dummyHealthText">100%</span>
                        </div>
                        <div class="dummy-model" id="dummyModel">
                            <div class="dummy-head"></div>
                            <div class="dummy-body"></div>
                            <div class="dummy-shadow"></div>
                        </div>
                        <div class="floating-text-container" id="floatingTextContainer"></div>
                    </div>

                    <div class="resource-panel">
                        <div class="energy-bar-container">
                            <div class="energy-bar" id="energyBar"></div>
                            <span class="energy-text" id="energyText">100 / 100</span>
                        </div>
                        <div class="combo-points" id="comboPoints">
                            <span class="combo-point"></span>
                            <span class="combo-point"></span>
                            <span class="combo-point"></span>
                            <span class="combo-point"></span>
                            <span class="combo-point"></span>
                        </div>
                        <div class="buff-timers" id="buffTimers"></div>
                        <div class="energy-forecast" id="energyForecast">
                            <h3>Energy Forecast</h3>
                            <div class="forecast-grid">
                                <div>
                                    <span class="label">+1s</span>
                                    <span class="value" id="forecast1">0</span>
                                </div>
                                <div>
                                    <span class="label">+3s</span>
                                    <span class="value" id="forecast3">0</span>
                                </div>
                                <div>
                                    <span class="label">+5s</span>
                                    <span class="value" id="forecast5">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="toolbar" id="actionBar"></section>

                <section class="combat-log-section">
                    <h2>Combat Log</h2>
                    <div class="combat-log" id="combatLog"></div>
                </section>
            </main>

            <!-- Right Panel: Analytics -->
            <aside class="panel analytics-panel">
                <section class="panel-section">
                    <h2>Live DPS</h2>
                    <div class="dps-display">
                        <span id="currentDPS">0</span>
                        <small>Damage per second</small>
                    </div>
                    <canvas id="dpsGraph" width="280" height="160"></canvas>
                </section>

                <section class="panel-section">
                    <h2>Statistics</h2>
                    <div class="stats-grid">
                        <div>
                            <span class="label">Total Damage</span>
                            <span id="totalDamage">0</span>
                        </div>
                        <div>
                            <span class="label">Average DPS</span>
                            <span id="averageDPS">0</span>
                        </div>
                        <div>
                            <span class="label">Hits</span>
                            <span id="hitCount">0</span>
                        </div>
                        <div>
                            <span class="label">Crits</span>
                            <span id="critCount">0</span>
                        </div>
                    </div>
                </section>

                <section class="panel-section">
                    <h2>Ability Breakdown</h2>
                    <div class="ability-breakdown">
                        <div class="breakdown-header">
                            <span>Ability</span>
                            <span>Uses</span>
                            <span>Damage</span>
                            <span>Share</span>
                        </div>
                        <div id="abilityBreakdownList" class="breakdown-list"></div>
                    </div>
                </section>

                <section class="panel-section">
                    <h2>Buffs & Debuffs</h2>
                    <div class="buff-list" id="buffList"></div>
                    <div class="debuff-list" id="debuffList"></div>
                </section>
            </aside>
        </div>
    </div>

    <div id="tooltip" class="ability-tooltip" hidden>
        <h3></h3>
        <p></p>
        <span class="tooltip-hotkey"></span>
    </div>

    <script src="dist/index.js" type="module"></script>
</body>
</html>
